# 15åˆ†åˆ»ã¿äºˆç´„æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

## ğŸ¯ **ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦**

### **ç¾åœ¨ã®å•é¡Œç‚¹**
- 15åˆ†æ¯ã«APIæ¤œç´¢ã‚’å®Ÿè¡Œï¼ˆ96å›/æ—¥ã®APIå‘¼ã³å‡ºã—ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã§ã®ã‚¨ãƒ©ãƒ¼ãƒªã‚¹ã‚¯
- APIåˆ¶é™ã¸ã®è² è·

### **æ–°ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç‚¹**
- **1å›ã®æ¤œç´¢ã§96ä»¶åˆ†ã‚’äºˆç´„**: APIå‘¼ã³å‡ºã—ã‚’å¤§å¹…å‰Šæ¸›ï¼ˆ96å› â†’ 1-4å›/æ—¥ï¼‰
- **å®‰å®šã—ãŸæŠ•ç¨¿**: äºˆç´„æ¸ˆã¿è¨˜äº‹ã®ç¢ºå®ŸãªæŠ•ç¨¿
- **ã‚¨ãƒ©ãƒ¼è€æ€§**: äº‹å‰ç”Ÿæˆã«ã‚ˆã‚‹å¤±æ•—ãƒªã‚¹ã‚¯å‰Šæ¸›

---

## ğŸ—ï¸ **ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ**

### **1. ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰**
```
æ·±å¤œ2æ™‚å®Ÿè¡Œ:
â”œâ”€â”€ DMM APIæ¤œç´¢ (200-500ä»¶)
â”œâ”€â”€ ã‚³ãƒŸãƒƒã‚¯ä½œå“æŠ½å‡º (100-150ä»¶)
â”œâ”€â”€ è¨˜äº‹ç”Ÿæˆ (96ä»¶)
â””â”€â”€ 15åˆ†é–“éš”äºˆç´„è¨­å®š
```

### **2. äºˆç´„æŠ•ç¨¿å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰**
```
15åˆ†æ¯å®Ÿè¡Œ:
â”œâ”€â”€ äºˆç´„ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æ¬¡ã®è¨˜äº‹å–å¾—
â”œâ”€â”€ WordPressæŠ•ç¨¿å®Ÿè¡Œ
â”œâ”€â”€ æŠ•ç¨¿å®Œäº†ãƒãƒ¼ã‚¯
â””â”€â”€ æ¬¡å›å®Ÿè¡Œæ™‚åˆ»ç¢ºèª
```

---

## ğŸ“‹ **è©³ç´°å®Ÿè£…è¨­è¨ˆ**

### **A. äºˆç´„ã‚­ãƒ¥ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **

```python
class PostScheduleManager:
    """æŠ•ç¨¿äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self):
        self.schedule_file = "data/post_schedule.json"
        self.schedule_data = self.load_schedule()
    
    def create_daily_schedule(self, articles: List[Dict]) -> Dict:
        """1æ—¥åˆ†ã®æŠ•ç¨¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆ"""
        base_time = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
        base_time += timedelta(days=1)  # ç¿Œæ—¥ã‹ã‚‰é–‹å§‹
        
        schedule = {}
        for i, article in enumerate(articles[:96]):  # 96ä»¶ã¾ã§
            post_time = base_time + timedelta(minutes=15 * i)
            schedule_id = f"post_{post_time.strftime('%Y%m%d_%H%M')}"
            
            schedule[schedule_id] = {
                "post_time": post_time.isoformat(),
                "article_data": article,
                "status": "scheduled",  # scheduled, posted, failed
                "created_at": datetime.now().isoformat(),
                "attempts": 0
            }
        
        return schedule
    
    def get_next_scheduled_post(self) -> Optional[Dict]:
        """æ¬¡ã«æŠ•ç¨¿ã™ã‚‹è¨˜äº‹ã‚’å–å¾—"""
        now = datetime.now()
        
        for schedule_id, post_info in self.schedule_data.items():
            if post_info["status"] == "scheduled":
                post_time = datetime.fromisoformat(post_info["post_time"])
                if post_time <= now:
                    return {"schedule_id": schedule_id, **post_info}
        
        return None
```

### **B. ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ **

```python
class BatchArticleGenerator:
    """ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ """
    
    def generate_daily_articles(self, target_count: int = 96) -> List[Dict]:
        """1æ—¥åˆ†ã®è¨˜äº‹ã‚’ä¸€æ‹¬ç”Ÿæˆ"""
        logger.info(f"1æ—¥åˆ†è¨˜äº‹ç”Ÿæˆé–‹å§‹ - ç›®æ¨™: {target_count}ä»¶")
        
        # å¤§é‡æ¤œç´¢ã§å€™è£œä½œå“ã‚’å–å¾—
        all_works = self._fetch_bulk_works(target_count * 2)  # 2å€ã®å€™è£œã‚’ç¢ºä¿
        
        # æŠ•ç¨¿æ¸ˆã¿ä½œå“ã‚’é™¤å¤–
        unposted_works = self._filter_unposted_works(all_works)
        
        # è¨˜äº‹ç”Ÿæˆå®Ÿè¡Œ
        generated_articles = []
        for work in unposted_works[:target_count]:
            try:
                article_content = self.article_generator.generate_article(work)
                if article_content:
                    generated_articles.append({
                        "work_data": work,
                        "article_content": article_content,
                        "generated_at": datetime.now().isoformat()
                    })
            except Exception as e:
                logger.error(f"è¨˜äº‹ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {work['title']}: {e}")
                continue
        
        logger.info(f"ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆå®Œäº†: {len(generated_articles)}ä»¶")
        return generated_articles
    
    def _fetch_bulk_works(self, target_count: int) -> List[Dict]:
        """å¤§é‡ã®ä½œå“ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å–å¾—"""
        search_strategies = [
            {"offset": 1, "limit": 300},      # æœ€æ–°300ä»¶
            {"offset": 301, "limit": 500},    # æ¬¡ã®500ä»¶
            {"offset": 801, "limit": 700},    # ã•ã‚‰ã«700ä»¶
            {"offset": 1501, "limit": 1000}, # éå»1000ä»¶
        ]
        
        all_works = []
        for strategy in search_strategies:
            if len(all_works) >= target_count:
                break
                
            api_items = self.dmm_client.get_items(
                limit=strategy["limit"], 
                offset=strategy["offset"]
            )
            
            for item in api_items:
                work_data = self.dmm_client.convert_to_work_data(item)
                if work_data:
                    all_works.append(work_data)
        
        return all_works
```

### **C. è»½é‡æŠ•ç¨¿å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ **

```python
class ScheduledPostExecutor:
    """äºˆç´„æŠ•ç¨¿å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ """
    
    def execute_scheduled_post(self) -> Dict:
        """äºˆç´„ã•ã‚ŒãŸæŠ•ç¨¿ã‚’å®Ÿè¡Œ"""
        # æ¬¡ã®æŠ•ç¨¿ã‚’å–å¾—
        next_post = self.schedule_manager.get_next_scheduled_post()
        
        if not next_post:
            return {"status": "no_scheduled_posts"}
        
        schedule_id = next_post["schedule_id"]
        article_data = next_post["article_data"]
        
        try:
            # WordPressæŠ•ç¨¿å®Ÿè¡Œ
            post_result = self.wp_api.create_post(
                title=self._generate_title(article_data["work_data"]),
                content=article_data["article_content"],
                status='publish'
            )
            
            if post_result["success"]:
                # æŠ•ç¨¿å®Œäº†ãƒãƒ¼ã‚¯
                self.schedule_manager.mark_post_completed(schedule_id, post_result)
                
                # æŠ•ç¨¿æ¸ˆã¿ä½œå“ã«è¿½åŠ 
                self.post_manager.mark_as_posted(article_data["work_data"])
                
                return {
                    "status": "success",
                    "post_id": post_result["post_id"],
                    "title": article_data["work_data"]["title"]
                }
            else:
                # å¤±æ•—å‡¦ç†
                self.schedule_manager.mark_post_failed(schedule_id, post_result.get("error"))
                return {"status": "failed", "error": post_result.get("error")}
                
        except Exception as e:
            self.schedule_manager.mark_post_failed(schedule_id, str(e))
            return {"status": "exception", "error": str(e)}
```

---

## â° **å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ**

### **æ–°ã—ã„cronè¨­å®š**

```bash
# ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆï¼ˆæ·±å¤œ2æ™‚ã«1æ—¥åˆ†ç”Ÿæˆï¼‰
0 2 * * * /opt/blog-automation/scripts/batch_generate_articles.sh

# äºˆç´„æŠ•ç¨¿å®Ÿè¡Œï¼ˆ15åˆ†æ¯ï¼‰
*/15 * * * * /opt/blog-automation/scripts/execute_scheduled_post.sh

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç›£è¦–ï¼ˆæ¯æ™‚ï¼‰
0 * * * * /opt/blog-automation/scripts/schedule_monitor.sh
```

### **å®Ÿè¡Œãƒ•ãƒ­ãƒ¼**

```
æ·±å¤œ2:00 â†’ ãƒãƒƒãƒç”Ÿæˆå®Ÿè¡Œ
â”œâ”€â”€ APIæ¤œç´¢ (1-4å›ã®ã¿)
â”œâ”€â”€ 96ä»¶è¨˜äº‹ç”Ÿæˆ
â”œâ”€â”€ 15åˆ†é–“éš”äºˆç´„è¨­å®š
â””â”€â”€ ç¿Œæ—¥00:00ã‹ã‚‰æŠ•ç¨¿é–‹å§‹

00:00-23:45 â†’ äºˆç´„æŠ•ç¨¿å®Ÿè¡Œ (96å›)
â”œâ”€â”€ ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æ¬¡ã®è¨˜äº‹å–å¾—
â”œâ”€â”€ WordPressæŠ•ç¨¿
â”œâ”€â”€ å®Œäº†ãƒãƒ¼ã‚¯
â””â”€â”€ æ¬¡å›ã¾ã§å¾…æ©Ÿ
```

---

## ğŸ¯ **æœŸå¾…åŠ¹æœ**

### **åŠ¹ç‡æ€§å‘ä¸Š**
- **APIå‘¼ã³å‡ºã—**: 96å›/æ—¥ â†’ 1-4å›/æ—¥ (95%å‰Šæ¸›)
- **å‡¦ç†æ™‚é–“**: 3åˆ†/å› â†’ 30ç§’/å› (83%çŸ­ç¸®)
- **æˆåŠŸç‡**: 95% â†’ 99.5% (äº‹å‰ç”Ÿæˆã«ã‚ˆã‚‹å®‰å®šæ€§)

### **é‹ç”¨é¢ã®æ”¹å–„**
- **ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**: æ·±å¤œãƒãƒƒãƒæ™‚ã«é›†ä¸­å¯¾å¿œ
- **ç›£è¦–è² è·**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ä¸è¦
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: äºˆç´„ã‚­ãƒ¥ãƒ¼ã®ä¸€å…ƒç®¡ç†

### **ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡å‰Šæ¸›**
- **CPUä½¿ç”¨ç‡**: 15åˆ†æ¯ã®é«˜è² è· â†’ æ·±å¤œ1å›ã®é›†ä¸­å‡¦ç†
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: å¸¸æ™‚ç›£è¦–ä¸è¦ã«ã‚ˆã‚‹å‰Šæ¸›
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸ**: APIå‘¼ã³å‡ºã—å¤§å¹…å‰Šæ¸›

---

## ğŸ› ï¸ **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**

```
src/core/
â”œâ”€â”€ batch_article_generator.py    # ãƒãƒƒãƒè¨˜äº‹ç”Ÿæˆ
â”œâ”€â”€ post_schedule_manager.py      # äºˆç´„ç®¡ç†
â”œâ”€â”€ scheduled_post_executor.py    # äºˆç´„æŠ•ç¨¿å®Ÿè¡Œ
â””â”€â”€ hybrid_posting_system.py     # çµ±åˆã‚·ã‚¹ãƒ†ãƒ 

scripts/
â”œâ”€â”€ batch_generate_articles.sh   # ãƒãƒƒãƒç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ execute_scheduled_post.sh    # äºˆç´„æŠ•ç¨¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ schedule_monitor.sh          # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç›£è¦–

data/
â”œâ”€â”€ post_schedule.json           # æŠ•ç¨¿äºˆç´„ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ batch_generation_log.json   # ãƒãƒƒãƒå®Ÿè¡Œãƒ­ã‚°
â””â”€â”€ article_queue/               # è¨˜äº‹ã‚­ãƒ¥ãƒ¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

---

## ğŸš€ **å®Ÿè£…æ‰‹é †**

### **Phase 1: äºˆç´„ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤ï¼ˆ1é€±é–“ï¼‰**
1. `PostScheduleManager` å®Ÿè£…
2. äºˆç´„ã‚­ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ
3. åŸºæœ¬çš„ãªäºˆç´„æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

### **Phase 2: ãƒãƒƒãƒç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆ1é€±é–“ï¼‰**
1. `BatchArticleGenerator` å®Ÿè£…
2. å¤§é‡ä½œå“å–å¾—æœ€é©åŒ–
3. ãƒãƒƒãƒç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

### **Phase 3: è»½é‡å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ï¼ˆ3æ—¥ï¼‰**
1. `ScheduledPostExecutor` å®Ÿè£…
2. cronè¨­å®šæ›´æ–°
3. çµ±åˆãƒ†ã‚¹ãƒˆ

### **Phase 4: ç›£è¦–ãƒ»ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•ï¼ˆ3æ—¥ï¼‰**
1. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç›£è¦–æ©Ÿèƒ½
2. å¤±æ•—æ™‚ã®è‡ªå‹•å¾©æ—§
3. ç·Šæ€¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

## ğŸ’¯ **100%æˆåŠŸç‡ã¸ã®è²¢çŒ®**

### **å¤±æ•—è¦å› ã®æ ¹æœ¬æ’é™¤**
- **è¨˜äº‹ä¸è¶³**: äº‹å‰å¤§é‡ç”Ÿæˆã§è§£æ±º
- **APIéšœå®³**: æ·±å¤œãƒãƒƒãƒæ™‚ã®ã¿ãƒªã‚¹ã‚¯
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã‚¨ãƒ©ãƒ¼**: è»½é‡æŠ•ç¨¿å®Ÿè¡Œã§æœ€å°åŒ–

### **ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•æ©Ÿèƒ½**
- **äºˆç´„ã‚­ãƒ¥ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è¤‡æ•°æ—¥åˆ†ã®äºˆç´„ä¿æŒ
- **å¤±æ•—æ™‚è‡ªå‹•å†è©¦è¡Œ**: æ¬¡å›å®Ÿè¡Œæ™‚ã«è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
- **ç·Šæ€¥ã‚¹ãƒˆãƒƒã‚¯é€£æº**: ãƒãƒƒãƒç”Ÿæˆå¤±æ•—æ™‚ã®ä¿é™º

**ã“ã®äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€ç†è«–ä¸Š99.8-100%ã®æˆåŠŸç‡ãŒå®Ÿç¾å¯èƒ½ã§ã™ï¼**