#!/usr/bin/env python3
"""
VPSç’°å¢ƒã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¸ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""
import json
import sys
from pathlib import Path


def update_posted_works_from_vps_list():
    """
    VPSã§æä¾›ã•ã‚ŒãŸæŠ•ç¨¿æ¸ˆã¿ä½œå“ãƒªã‚¹ãƒˆã§ãƒ­ãƒ¼ã‚«ãƒ«ã®posted_works.jsonã‚’æ›´æ–°
    """
    print("ğŸ”„ VPSç’°å¢ƒã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¸ã®æŠ•ç¨¿æ¸ˆã¿ä½œå“ãƒªã‚¹ãƒˆåŒæœŸã‚’é–‹å§‹...")
    
    # VPSã‹ã‚‰æä¾›ã•ã‚ŒãŸæŠ•ç¨¿æ¸ˆã¿ä½œå“ãƒªã‚¹ãƒˆï¼ˆ162ä»¶ï¼‰
    vps_posted_work_ids = [
        "d_644177", "d_636505", "d_642095", "d_643164", "d_619638", "d_641354",
        "d_642623", "d_504593", "d_633782", "d_638647", "d_639698", "d_644479",
        "d_618855", "d_641720", "d_634570", "d_644314", "d_642994", "d_615824",
        "d_643818", "d_636848", "d_644048", "d_644328", "d_639267", "d_641423",
        "d_644510", "d_641914", "d_639586", "d_645547", "d_642268", "d_633486",
        "d_637945", "d_644275", "d_642702", "d_636726", "d_636664", "d_643805",
        "d_635797", "d_640194", "d_634097", "d_643021", "d_623317", "d_640430",
        "d_635262", "d_641932", "d_643763", "d_641576", "d_637390", "d_642235",
        "d_625486", "d_634924", "d_643078", "d_638612", "d_644093", "d_644517",
        "d_636548", "d_638697", "d_635974", "d_643848", "d_636181", "d_640527",
        "d_641920", "d_638857", "d_639235", "d_644222", "d_623351", "d_633362",
        "d_568529", "d_641544", "d_644378", "d_630391", "d_643861", "d_642008",
        "d_585658", "d_592509", "d_640740", "d_610710", "d_620024", "d_643653",
        "d_641712", "d_615275", "d_594837", "d_640484", "d_643935", "d_643111",
        "d_600393", "d_631037", "d_623756", "d_639163", "d_638876", "d_642848",
        "d_598293", "d_637209", "d_641717", "d_644455", "d_601389", "d_640566",
        "d_642905", "d_607719", "d_639446", "d_643729", "d_641149", "d_626031",
        "d_643795", "d_642220", "d_641689", "d_644325", "d_645754", "d_638701",
        "d_578433", "d_428050", "d_643482", "d_638080", "d_593706", "d_644478",
        "d_637841", "d_589255", "d_634038", "d_643388", "d_644360", "d_628999",
        "d_593678", "d_641357", "d_628551", "d_644518", "d_639448", "d_644082",
        "d_601482", "d_637457", "d_644105", "d_644179", "d_643696", "d_643834",
        "d_629804", "d_642654", "d_645030", "d_643291", "d_590748", "d_641666",
        "d_494326", "d_640816", "d_639095", "d_624058", "d_632859", "d_642778",
        "d_636957", "d_616468", "d_641791", "d_635602", "d_598352", "d_644385",
        "d_640259", "d_634870", "d_644023", "d_638168", "d_629943", "d_631352",
        "d_643890", "d_645617", "d_644100", "d_639420", "d_644088", "d_643926",
        "d_639656", "d_637054", "d_642934", "d_635096", "d_643027", "d_635775",
        "d_622331", "d_614852", "d_638538", "d_639807", "d_641200"
    ]
    
    # ãƒ­ãƒ¼ã‚«ãƒ«ã®posted_works.jsonãƒ‘ã‚¹
    posted_works_file = Path("data/posted_works.json")
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
    if posted_works_file.exists():
        backup_file = posted_works_file.with_suffix('.json.backup')
        with open(posted_works_file, 'r', encoding='utf-8') as f:
            current_data = json.load(f)
        
        with open(backup_file, 'w', encoding='utf-8') as f:
            json.dump(current_data, f, ensure_ascii=False, indent=2)
        
        print(f"ğŸ“ ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {backup_file}")
        print(f"   ç¾åœ¨ã®æŠ•ç¨¿æ¸ˆã¿ä»¶æ•°: {len(current_data.get('posted_work_ids', []))}")
    
    # VPSãƒ‡ãƒ¼ã‚¿ã§æ›´æ–°
    updated_data = {
        "posted_work_ids": vps_posted_work_ids
    }
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰
    posted_works_file.parent.mkdir(parents=True, exist_ok=True)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
    with open(posted_works_file, 'w', encoding='utf-8') as f:
        json.dump(updated_data, f, ensure_ascii=False, indent=2)
    
    print(f"âœ… ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’æ›´æ–°å®Œäº†:")
    print(f"   æ–°ã—ã„æŠ•ç¨¿æ¸ˆã¿ä»¶æ•°: {len(vps_posted_work_ids)}")
    print(f"   d_590748ã®çŠ¶æ…‹: {'âœ… å«ã¾ã‚Œã¦ã„ã¾ã™' if 'd_590748' in vps_posted_work_ids else 'âŒ å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“'}")
    
    # æ¤œè¨¼
    with open(posted_works_file, 'r', encoding='utf-8') as f:
        verification_data = json.load(f)
    
    if verification_data.get('posted_work_ids') == vps_posted_work_ids:
        print("âœ… ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèªå®Œäº†")
    else:
        print("âŒ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã«å•é¡ŒãŒã‚ã‚Šã¾ã™")
        return False
    
    print(f"\nğŸ¯ é‡è¦: d_590748ã®é‡è¤‡æŠ•ç¨¿å•é¡ŒãŒè§£æ±ºã•ã‚Œã¾ã—ãŸ")
    print(f"   ã‚·ã‚¹ãƒ†ãƒ ã¯ä»Šå¾Œã€d_590748ã‚’æŠ•ç¨¿æ¸ˆã¿ä½œå“ã¨ã—ã¦æ­£ã—ãèªè­˜ã—ã¾ã™")
    
    return True


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    try:
        success = update_posted_works_from_vps_list()
        
        if success:
            print(f"\nğŸ“‹ æ¬¡ã®æ‰‹é †:")
            print(f"1. é‡è¤‡æŠ•ç¨¿é˜²æ­¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ: python test_posted_check.py")
            print(f"2. VPSç’°å¢ƒã¨ã®å®šæœŸåŒæœŸã®æ¤œè¨")
            print(f"3. ã“ã®åŒæœŸã‚’ä»Šå¾Œã‚‚å®šæœŸçš„ã«å®Ÿè¡Œ")
        
        sys.exit(0 if success else 1)
        
    except Exception as e:
        print(f"âŒ åŒæœŸå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: {e}")
        sys.exit(1)


if __name__ == "__main__":
    main()