# WordPress自動投稿システム仕様書

## 1. システムの目的
FANZAの同人作品情報を元に、AIを活用してユニークな紹介記事を生成し、指定したスケジュールでWordPressに自動で予約投稿する。これにより、ブログコンテンツの継続的な更新を自動化し、アフィリエイト収益の向上を目指す。

## 2. システム概要
- **使用言語/環境:** Python
- **実行環境:** VPS（仮想専用サーバー）
- **設定管理:** WordPress接続情報、APIキー等は **`config.ini`** のような外部設定ファイルで管理する。
- **連携サービス:**
    - **WordPress (投稿先):** REST APIを利用
    - **FANZA (情報取得元)**
    - **Gemini API (文章生成AI):** APIキーが必要

## 3. 主な機能
1.  **作品情報取得機能:**
    - **情報取得元URL:** `https://www.dmm.co.jp/dc/doujin/-/list/=/media=comic/review_score=3.5/section=mens/sort=date/?dmmref=detailedSearch`
    - **クロール方法:** 上記URLから各作品の詳細ページURLを順番に取得し、アクセスする。
    - **取得対象データ:**
        - 作品タイトル
        - サークル名、作者名
        - FANZAのカテゴリ
        - パッケージ画像URL
        - 公式の作品紹介文
        - 作品ページ数
        - ジャンル
        - サンプル画像URL（複数）
        - レビュー
        - アフィリエイトリンク生成用の情報

2.  **記事生成機能:**
    - 取得した情報を元に、以下の構成で記事データを生成する。
        - **記事タイトル:** `[作品名]`
        - **タグ:** `作者名`, `サークル名`
        - **カテゴリ:** FANZAのカテゴリをそのまま設定
        - **本文:**
            - **導入文:** 「エロ同人サークル「<a href="[サークル名のタグアーカイブURL]">[サークル名]</a>」のエロマンガです。」
            - **パッケージ画像**
            - **商品紹介文:** FANZAの紹介文とタイトルを元に、Gemini APIで180字程度にリライトした文章。
                - **Gemini APIへの指示（プロンプト）例:** `「以下の作品紹介文を、読者の興味を引くように180字程度で書き直してください。作品名：{作品名}、紹介文：{紹介文}」`
            - **作品ページ数**
            - **ジャンル**（内部リンク化を想定）
            - **サンプル画像**（複数枚）
            - **アフィリエイトリンク（ボタン形式）**
                - **ボタンのHTMLコード例:** `<div class="swell-block-button red_ is-style-btn_solid"><a href="{アフィリエイトURL}" class="swell-block-button__link"><span>続きを読むにはクリック</span></a></div>`
            - **レビュー**
            - **H2見出し**（以下の3パターンからランダムで選択）
                1. H2見出し/パターン1
                2. H2見出し/パターン2
                3. H2見出し/パターン3
            - **関連作品**（WordPressの機能で表示させることを想定）

3.  **投稿管理機能:**
    - **重複投稿防止:** 一度投稿した作品のIDを **JSONファイル** に記録し、次回以降は投稿しないようにチェックする。
    - **スケジューリング:** 15分に1回のペースでスクリプトを実行する (cron等で設定)。
    - **予約投稿:** 実行日の翌日分として、WordPressに予約投稿を行う。例えば、4月1日の00:00〜23:45の間に実行された96件の投稿は、すべて4月2日分として予約される。

4.  **エラー処理機能:**
    - FANZAのページ構造変更や、情報取得に失敗した場合、エラーをログに記録し、その回の投稿をスキップする。
    - Gemini APIやWordPress APIの呼び出しに失敗した場合も同様に、エラーを記録して処理を中断する。

## 4. 処理フロー
1.  **[定刻]** VPS上でPythonスクリプトが自動実行される。
2.  **[設定読込]** `config.ini`からWordPress接続情報やAPIキーを読み込む。
3.  **[重複チェック]** 投稿済みリスト（JSONファイル）を読み込む。
4.  **[情報取得]** 指定されたURLからFANZAのサイトを巡回し、未投稿の新しい作品情報を探す。
5.  **[対象発見]** 未投稿の作品を見つけたら、その作品ページから必要な情報をすべて取得する。
6.  **[AIリライト]** 指定したプロンプトテンプレートを使い、取得した紹介文をGemini APIに渡し、リライトされた文章を受け取る。
7.  **[記事生成]** 取得・生成した全データを使って、WordPress投稿用の記事データを作成する。
8.  **[予約投稿]** WordPressのREST APIを呼び出し、翌日の日付で予約投稿を行う。
9.  **[記録]** 投稿が成功したら、その作品IDを投稿済みリスト（JSONファイル）に追加して保存する。
10. **[終了]** スクリプトの処理を終了する。
